{% extends "base.html" %}
{% from "cursos/_article.html" import article_navbar, section_header %}
{% from "_button_link.html" import button_link %}
{# Requires dict section_headers #}


{% block content_navbar %}
<nav id="article-navbar" class="navbar navbar-custom" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-center">
                {# <!-- Article sections --> #}
                {{article_navbar(section_headers)}}
            </ul>
        </div>
    </div>
</nav>
{% endblock content_navbar %}



{% block page_content %}

    <!-- Article -->
    {% block article %}{% endblock article %}
    
    
    <!-- Quiz section header -->
    {% if form and score != None and max_score != None %}
        {{section_header("evaluacion", section_headers)}}
    {% endif %}
    

    <!-- Create quiz button -->
    
    
    <style>
        #quizContainer{
            width: 100%;
            height: 50vh;
            background-color:  #FFE1A4;
        }

        #takeQuizBtn{
            position: relative;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes kf-fade-in {
            0% {opacity: 0;}
            100% {opacity: 1;}
        }

        .fade-in{
            animation-name: kf-fade-in;
            animation-duration: 2s;
        }

    </style>
    <div id="quizContainer">
        <button id="takeQuizBtn" class="btn">Hacer examen</button>
    </div>

{# 
    <!-- Commented out old quizzes -->
    <!-- Download certificate -->
    {% if already_passed == True and certificate_endpoint %}
        {{
            button_link(
                href=url_for("main.certificate", name=certificate_endpoint),
                btn_text="Descargar certificado",
                target="_blank"
            )
        }}
    {% endif %}

    <!-- Quiz -->
    {{quiz(form, score, max_score)}}

#}
{% endblock page_content %}

{% block scripts %}
{{super()}}
{% with topic = "tstc", num_questions = 5 %}
<script>
    
    /**
     * Fetches quiz html for the quiz form.
     * 
     * @param HTMLElement htmlElement Container tag for the quiz
     * @param string topic Codename of the quiz topic
     * @param number numQuestions Number of questions for the quiz
     */
    function renderNewQuiz(htmlElem, topic, numQuestions){
        const endpoint = "{{url_for('api.get_quiz_html')}}" + "?topic=" + topic + "&num_questions" + numQuestions;
        $.ajax(endpoint, {
            type:"post",
            success:(htmlContent)=>{
                quizBtn.style.display = "none";
                htmlElem.innerHTML += htmlContent;
                htmlElem.classList.add("fade-in")

            },
            error: () => console.log("Kaput!")
        })
    }

    const quizElem = document.getElementById("quizContainer");
    const quizBtn = document.getElementById("takeQuizBtn");

    const quizTopic = "{{topic}}";
    const numQuizQuestions = {{num_questions}};

    // Add event listener on click to fetch new quiz
    // Only works once
    quizBtn.onclick = ()=> {
        renderNewQuiz(quizElem, quizTopic, numQuizQuestions)
        quizBtn.onclick = null;
    }

    


    

</script>
{% endwith %}
{% endblock scripts %}