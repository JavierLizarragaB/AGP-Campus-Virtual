{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}
AGP Campus Virtual
{% endblock title %}

{% block head %}
{{ super() }}
<link rel="shortcut icon" type="image/jpg" href="/static/img/AGP-icon.png" />
{#<!-- <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/glacial-indifference" /> -->#}
<link rel="stylesheet" href="/static/css/style.css">
{% endblock %}

{% block navbar %}
<a href={{url_for("main.index")}}>
    <img id="navbarLogo" src="/static/img/AGP-Nombre.png">
</a>
<nav id="navbar" class="navbar navbar-custom" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-center">
                {# <!-- Cancer type links --> #}
                <li><a href={{url_for("cursos.diagnostico")}}>Inicio</a></li>
                <li><a href={{url_for("cursos.cancer_testiculo")}}>Cáncer Testicular</a></li>
                <li><a href={{url_for("cursos.cancer_prostata")}}>Cáncer en Próstata</a></li>
                <li><a href={{url_for("cursos.cancer_pulmon")}}>Cáncer en Pulmón</a></li>
                <li><a href={{url_for("cursos.cancer_mama")}}>Cáncer de Mama</a></li>
                <li><a href={{url_for("cursos.cancer_cervicouterino")}}>Cáncer Cervicouterino</a></li>

                {# <!-- User auth links --> #}
                {% if current_user and not current_user.is_anonymous %}
                <li><a href={{url_for("auth.perfil")}}>Pefil</a></li>
                <li><a href={{url_for("auth.logout")}}>Cerrar Sesión</a></li>
                {% else %}
                <li><a href={{url_for("auth.login")}}>Iniciar Sesión</a></li>
                <li><a href={{url_for("auth.registrarse")}}>Registrarse</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
{% endblock navbar %}


{% block content %}
{% block banner %}{% endblock banner %}
<div id="alerts"></div>
<div id="page-content" class="container">
    <!-- Flashed messages -->
    <!-- TODO: Changet this to new flash system -->
    {% for message in get_flashed_messages() %}
    <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        {{message}}
    </div>
    {% endfor %}
    

    {#{% block banner %}{% endblock banner %}#}
    {% block page_content %}{% endblock page_content %}
</div>

{#<!-- Footer -->#}
<footer class="container-fluid">
    <div class="row">
        <div id="footer-branding" class="col-md-3">
            <a href="{{url_for('main.index')}}">
                <img id="footerLogo" src="/static/img/AGP logo PNG.png">
            </a>
        </div>
        <div class="col-md-3">
            <h3>Dirección</h3>
            <a href="https://goo.gl/maps/YvmCNgkY3BVpnojC9" target="_blank">
                <img class="icon" src="/static/img/location-icon.png">
                <span>Olivares, Luis Encinas, 83138 Hermosillo, Son.</span>
            </a>
        </div>
        <div class="col-md-3">
            <h3>Teléfono</h3>
            <a href="tel:6622164883" target="_blank">
                <img class="icon" src="/static/img/phone-icon.png">
                <span>662 216 4883</span>
            </a>
        </div>
        <div class="col-md-3">
            <h3>Redes sociales</h3>
            <a href="https://www.facebook.com/AGPHermosillo.Oficial/" target="_blank">
                <img class=" icon" src="/static/img/facebook-logo.png">
                <span>AGP Hermosillo</span>
            </a><br>
            <a href="https://www.instagram.com/agp_hermosillo/" target="_blank">
                <img class="icon" src="/static/img/instagram-logo.png">
                <span>@agp_hermosillo</span>
            </a><br>
            <a href="https://twitter.com/agphilloOFICIAL" target="_blank">
                <img class="icon" src="/static/img/twitter-logo.png">
                <span>@agphilloOFICIAL</span>
            </a><br>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 text-center copyright">
            Asociación George Papanicolau A. C. 2020 © Todos los derechos reservados
        </div>
    </div>
</footer>
{% endblock content %}


{% block scripts %}
{{super()}}
<!-- <script src="/static/js/script.js"></script> -->

{#<!-- TODO: Remove the reload cachced files script from production release. -->#}
<script src="/static/js/reloadCachedCSS.js"></script>
<script type="text/javascript">var topButton = "sleek/circle-blue";</script>
<script type="text/javascript" src="//backtotopbutton.com/script/toTop.js"></script>


<script>

    const alertsTagId = "alerts";
    const alertsLocalStorageKey = "alerts";


    function updateAlertsLocalStorage(tagId = alertsTagId, localStorageKey = alertsLocalStorageKey){
        const alerts = document.getElementById(tagId);
        if (alerts === undefined){
            console.log(`[ERROR] Could not find alert widget with id '${tagId}'`)
            return;
        }
        localStorage.setItem(localStorageKey, alerts.innerHTML)
    }

    // Remove the alert html tag and updated local storage
    function closeAlert(e){ 
        e.target.parentElement.remove;
        updateAlertsLocalStorage();
    }

    // Updates html for flashes
    function dispStoredFlashes(tagId = alertsTagId, localStorageKey = alertsLocalStorageKey){
        document.getElementById(tagId).innerHTML = localStorage.getItem(localStorageKey)
    }

    // Fetches the alerts from the backend endpoint
    function getAlerts(tagId = alertsTagId, localStorageKey = alertsLocalStorageKey) {
        // Get alerts from api
        $.ajax("{{url_for('main.flashed_messages')}}", {
            type: "post",
            success: (flashes) => {
                // Get the alerts widget from tag id
                const alertsWidget = document.getElementById(tagId);
                
                // Validate it exists
                if (alertsWidget === undefined){
                    console.log(`[ERROR] Could not find alert widget with id '${tagId}'`)
                    return;
                }
                
                // Change the html
                const flashesHTMLStr = localStorage.getItem(alertsLocalStorageKey) + flashes;

                // Save the flashes in the local storage
                localStorage.setItem(localStorageKey, flashesHTMLStr)

                // Change the html
                alertsWidget.innerHTML = flashesHTMLStr;

                // Add event listeners to close the objects with click on cross.
                let closeButtons = document.getElementsByClassName("close");
                for(i = 0; i < closeButtons.length; i++){
                    closeButtons[i].addEventListener("click", closeAlert);
                }
            },
            error: (xhr, status, error) => console.log(`[ERROR] Could not get flashsed messages, xhr: ${xhr}, status: ${status}, error: ${error} `)

        })
    }

    getAlerts();
</script>
{% endblock scripts %}

</html>